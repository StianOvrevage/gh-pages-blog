<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="I denne posten setter vi opp et managed Kubernetes cluster fra scratch ved bruk av Azure CLI."><title>Managed Kubernetes p√• Microsoft Azure (Norwegian)</title>
<link rel=canonical href=https://blog.stian.omg.lol/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Managed Kubernetes p√• Microsoft Azure (Norwegian)"><meta property='og:description' content="I denne posten setter vi opp et managed Kubernetes cluster fra scratch ved bruk av Azure CLI."><meta property='og:url' content='https://blog.stian.omg.lol/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/'><meta property='og:site_name' content='blog.stian.omg.lol'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='azure'><meta property='article:published_time' content='2017-12-25T00:00:00+00:00'><meta property='article:modified_time' content='2017-12-25T00:00:00+00:00'><meta property='og:image' content='https://blog.stian.omg.lol/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/2017-12-23-managed-kubernetes-on-azure.png'><meta name=twitter:title content="Managed Kubernetes p√• Microsoft Azure (Norwegian)"><meta name=twitter:description content="I denne posten setter vi opp et managed Kubernetes cluster fra scratch ved bruk av Azure CLI."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.stian.omg.lol/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/2017-12-23-managed-kubernetes-on-azure.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/profile-picture_hu6892409687065925510.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ü§∑‚Äç‚ôÇÔ∏è</span></figure><div class=site-meta><h1 class=site-name><a href=/>blog.stian.omg.lol</a></h1><h2 class=site-description>Technology. Aviation. Philosophy.</h2></div></header><ol class=menu-social><li><a href=https://github.com/StianOvrevage target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><ol><li><a href=#microsoft-azure>Microsoft Azure</a></li></ol></li></ol></li><li><a href=#bakgrunn>Bakgrunn</a><ol><li><a href=#docker-containers>Docker containers</a><ol><li><a href=#container-orchestration>Container orchestration</a></li></ol></li></ol></li><li><a href=#opprette-azure-kubernetes-cluster>Opprette Azure Kubernetes Cluster</a><ol><li><a href=#forbehold>Forbehold</a></li><li><a href=#forberedelser>Forberedelser</a></li><li><a href=#azure-innlogging>Azure innlogging</a></li><li><a href=#aktiver-containerservice>Aktiver ContainerService</a></li><li><a href=#opprett-en-resource-group>Opprett en resource group</a></li><li><a href=#opprette-kubernetes-cluster>Opprette Kubernetes cluster</a></li><li><a href=#installer-kubectl>Installer kubectl</a></li><li><a href=#inspiser-cluster>Inspiser cluster</a></li><li><a href=#starte-noen-nginx-containere>Starte noen nginx containere</a></li><li><a href=#gj√∏re-nginx-tilgjengelig-med-en-tjeneste>Gj√∏re nginx tilgjengelig med en tjeneste</a></li><li><a href=#skalere-cluster>Skalere cluster</a></li><li><a href=#slette-cluster>Slette cluster</a></li></ol></li><li><a href=#bonusmateriale>Bonusmateriale</a><ol><li><a href=#rulle-ut-tjenester-med-helm>Rulle ut tjenester med Helm</a><ol><li><a href=#rulle-ut-minecraft-med-helm>Rulle ut MineCraft med Helm</a></li></ol></li><li><a href=#kubernetes-dashboard>Kubernetes Dashboard</a></li></ol></li><li><a href=#konklusjon>Konklusjon</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/><img src=/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/2017-12-23-managed-kubernetes-on-azure_hu16663104706739538126.png srcset="/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/2017-12-23-managed-kubernetes-on-azure_hu16663104706739538126.png 800w, /p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/2017-12-23-managed-kubernetes-on-azure_hu1452018469364866544.png 1600w" width=800 height=457 loading=lazy alt="Featured image of post Managed Kubernetes p√• Microsoft Azure (Norwegian)"></a></div><div class=article-details><header class=article-category><a href=/categories/technology/ style=background-color:#2a9d8f;color:#fff>Technology</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/>Managed Kubernetes p√• Microsoft Azure (Norwegian)</a></h2><h3 class=article-subtitle>I denne posten setter vi opp et managed Kubernetes cluster fra scratch ved bruk av Azure CLI.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 25, 2017</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div></footer></div></header><section class=article-content><p><em>Update 29. Dec: There is an <a class=link href=/2017/12/29/managed-kubernetes-on-azure-eng.html>English version of this post here.</a></em></p><p>Kubernetes (K8s) er i ferd med √• bli de-facto standard for deployments av kontainer-baserte applikasjoner. Microsoft har n√• preview av deres managed Kubernetes tjeneste (Azure Kubernetes Service, AKS) som gj√∏r det enkelt √• opprette et Kubernetes cluster og rulle ut tjenester uten √• m√•tte ha kompetanse og tid til den daglige driften av selve Kubernetes-clusteret, som per i dag kan v√¶re relativt komplisert og tidkrevende.</p><p>I denne posten setter vi opp et Kubernetes cluster fra scratch ved bruk av Azure CLI.</p><p>Table of contents</p><ul><li><a class=link href=#Bakgrunn>Bakgrunn</a><ul><li><a class=link href=#Dockercontainers>Docker containers</a></li><li><a class=link href=#Containerorchestration>Container orchestration</a></li></ul></li><li><a class=link href=#OppretteAKS>Kom i gang med Azure Kubernetes - AKS</a><ul><li><a class=link href=#Forbehold>Forbehold</a></li><li><a class=link href=#Forberedelser>Forberedelser</a></li><li><a class=link href=#Azureinnlogging>Azure innlogging</a></li><li><a class=link href=#AktiverContainerService>Aktiver ContainerService</a></li><li><a class=link href=#OpprettResourceGroup>Opprett en resource group</a></li><li><a class=link href=#OpprettK8sCluster>Opprette Kubernetes cluster</a></li><li><a class=link href=#InstallerKubectl>Installer kubectl</a></li><li><a class=link href=#InspiserCluster>Inspiser cluster</a></li><li><a class=link href=#StarteNginx>Starte noen nginx containere</a></li><li><a class=link href=#NginxService>Gj√∏re nginx tilgjengelig med en tjeneste</a></li><li><a class=link href=#ScaleCluster>Skalere cluster</a></li><li><a class=link href=#DeleteCluster>Slette cluster</a></li></ul></li><li><a class=link href=#Bonusmateriale>Bonusmateriale</a><ul><li><a class=link href=#HelmIntro>Rulle ut tjenester med Helm pakker</a><ul><li><a class=link href=#HelmMinecraft>MineCraft server med Helm</a></li></ul></li><li><a class=link href=#KubernetesDashboard>Kubernetes Dashboard</a></li></ul></li><li><a class=link href=#Konklusjon>Konklusjon</a></li></ul><h4 id=microsoft-azure>Microsoft Azure</h4><blockquote><p><a class=link href=https://azure.microsoft.com/en-us/free/ target=_blank rel=noopener>Hvis du ikke har Azure fra f√∏r kan du pr√∏ve tjenester for $200 i 30 dager.</a> VM typen <strong>Standard_B2s</strong> er Burstable, har 2vCPU, 4GB RAM, 8GB temp storage og koster ~$38 / mnd. For $200 kan du ha et cluster p√• 3-4 B2s noder plus trafikkostnad, lastbalanserere og andre n√∏dvendige tjenester.</p></blockquote><blockquote><p><em>Vi har ingen tilknytning til Microsoft bortsett fra at de sponser v√•r startup <a class=link href=http://www.datadynamics.no/ target=_blank rel=noopener>DataDynamics</a> med cloud-tjenester i 24 mnd i deres <a class=link href=https://bizspark.microsoft.com/ target=_blank rel=noopener>BizSpark program</a>.</em></p></blockquote><p><a id=Bakgrunn></a></p><h2 id=bakgrunn>Bakgrunn</h2><p><a id=Dockercontainers></a></p><h3 id=docker-containers>Docker containers</h3><p><em>Vi tar ikke for oss Docker containers i dybden i denne posten, men her er en kort oppsummering for de som ikke er kjent med teknologien.</em></p><p>Docker er en m√•te √• pakketere programvare slik at det kan kj√∏res p√• samtlige popul√¶re platformer uten √• m√•tte bruke mye tid p√• dependencies, oppsett og konfigurasjon.</p><p>I tillegg bruker en Docker container operativsystemet p√• vertsmaskinen n√•r den kj√∏rer. Dette gj√∏r at en kan kj√∏re mange flere containere p√• samme vertsmaskin sammenlignet med virtuelle maskiner.</p><p>Her er en ufullstendig og grov sammenligning mellom en Docker container og en virtuell maskin:</p><div class=table-wrapper><table><thead><tr><th></th><th>Virtuel maskin</th><th>Docker container</th></tr></thead><tbody><tr><td>Image st√∏rrelse</td><td>fra 200MB til mange GB</td><td>fra 10MB til 3-400MB</td></tr><tr><td>Oppstartstid</td><td>60 sekunder +</td><td>1-10 sekunder</td></tr><tr><td>Minnebruk</td><td>256MB-512MB-1GB +</td><td>2MB +</td></tr><tr><td>Sikkerhet</td><td>God isolasjon mellom VM</td><td>D√•rligere isolasjon mellom containere</td></tr><tr><td>Bygge image</td><td>Minutter</td><td>Sekunder</td></tr></tbody></table></div><blockquote><p><strong>PS</strong> Tallene for virtuelle maskiner er tatt fra hukommelsen. Jeg fors√∏kte √• starte en MySQL virtuell appliance p√• min laptop men VMware Player nekter √• kj√∏re pga inkompatibilitet med Windows Hyper-V. VMware Workstation nekter √• kj√∏re pga utg√•tt lisens og Oracle VirtualBox gir en nasty bluescreen gang p√• gang. Hooray!</p></blockquote><blockquote><p><strong>Protip</strong> De minste og raskeste Docker imagene er bygget p√• Alpine Linux. For webserveren Nginx er det Alpine-baserte imaget 15MB mot det Debian-baserte imaget p√• 108MB. PostgreSQL:Alpine er 38MB mot 287MB. Siste versjon av MySQL er 343MB men vil i versjon 8 st√∏tte Alpine Linux ogs√•.</p></blockquote><p>Noen av fordelene med Docker containers er alts√•:</p><ul><li>Kompatibilitet p√• tvers av platformer, Linux, Windows og MacOS.</li><li>10-100x mindre st√∏rrelse. Raskere √• laste ned, raskere √• bygge, raskere √• laste opp.</li><li>Minnebruk kun for applikasjon og ikke eget OS.<ul><li>Fordel under utvikling, kan kj√∏re 10-20-30 Docker containere samtidig p√• en laptop.</li><li>Fordel i produksjon, kan redusere hardware utgifter betraktelig.</li></ul></li><li>Oppstart p√• f√• sekunder. Gj√∏r dynamisk skalering av applikasjoner mye enklere.</li></ul><p><a class=link href=https://store.docker.com/editions/community/docker-ce-desktop-windows target=_blank rel=noopener>Last ned Docker for Windows her.</a></p><p>Og start en MySQL database fra Windows CMD eller Powershell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run --name mysql -p 3306:3306 -e MYSQL_RANDOM_ROOT_PASSWORD=true mysql
</span></span></code></pre></td></tr></table></div></div><p>Stop containeren med:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker kill mysql
</span></span></code></pre></td></tr></table></div></div><p>En kan s√∏ke etter ferdige Docker images p√• <a class=link href=https://hub.docker.com/ target=_blank rel=noopener>Docker Hub</a>. Det er ogs√• mulig √• lage private Docker repositories for egen programvare som ikke skal v√¶re tilgjengelig for omverden.</p><p><a id=Containerorchestration></a></p><h4 id=container-orchestration>Container orchestration</h4><p>Etter som Docker containers har blitt den foretrukne m√•ten √• pakke og distribuere programvare p√• Linux platformen de siste par √•rene har det vokst frem et behov for systemer som kan samkj√∏re drift og utrulling av disse containerene. Ikke ulikt det √∏kosystemet av produkter VMware har bygget opp rundt utvikling og drift av virtuelle maskiner.</p><p>Container orchestration systemene har som oppgave √• s√∏rge for:</p><ul><li>Lastbalansering.</li><li>Service discovery.</li><li>Health checks.</li><li>Automatisk skalering og restarting av vertsmaskiner og containere.</li><li>Oppgraderinger uten nedetid (rolling deploy).</li></ul><p>Frem til nylig har √∏kosystemet rundt container orchestration v√¶rt fragmentert og de mest popul√¶re alternativene har v√¶rt:</p><ul><li><a class=link href=https://kubernetes.io/ target=_blank rel=noopener>Kubernetes</a> (Opprinnelig fra Google, n√• styrt av CNCF, Cloud Native Computing Foundation)</li><li><a class=link href=https://docs.docker.com/engine/swarm/ target=_blank rel=noopener>Swarm</a> (Fra produsenten bak Docker)</li><li><a class=link href=http://mesos.apache.org/ target=_blank rel=noopener>Mesos</a> (Fra Apache Software Foundation)</li><li><a class=link href=https://github.com/coreos/fleet target=_blank rel=noopener>Fleet</a> (Fra CoreOS)</li></ul><p>Men det siste √•ret har det v√¶rt en konvergens mot Kubernetes som foretrukket l√∏sning.</p><ul><li>7 februar<ul><li><a class=link href=https://coreos.com/blog/migrating-from-fleet-to-kubernetes.html target=_blank rel=noopener>CoreOS annonserer at de fjerner Fleet fra Container Linux og anbefaler Kubernetes</a></li></ul></li><li>27 juli<ul><li><a class=link href=https://azure.microsoft.com/en-us/blog/announcing-cncf/ target=_blank rel=noopener>Microsoft slutter seg til CNCF</a></li></ul></li><li>9 august<ul><li><a class=link href=https://techcrunch.com/2017/08/09/aws-joins-the-cloud-native-computing-foundation/ target=_blank rel=noopener>Amazon Web Services slutter seg til CNCF</a></li></ul></li><li>29 august<ul><li><a class=link href=https://www.geekwire.com/2017/now-vmware-pivotal-cncf-becoming-hub-enterprise-tech/ target=_blank rel=noopener>VMware og Pivotal slutter seg til CNCF</a></li></ul></li><li>17 september<ul><li><a class=link href=https://techcrunch.com/2017/09/13/oracle-joins-the-cloud-native-computing-foundation-as-a-platinum-member/ target=_blank rel=noopener>Oracle slutter seg til CNCF</a></li></ul></li><li>17 oktober<ul><li><a class=link href=https://www.theregister.co.uk/2017/10/17/docker_ee_kubernetes_support/ target=_blank rel=noopener>Docker annonserer native st√∏tte for Kubernetes i tillegg til sitt eget Swarm produkt</a></li></ul></li><li>24 oktober<ul><li><a class=link href=https://azure.microsoft.com/en-us/blog/introducing-azure-container-service-aks-managed-kubernetes-and-azure-container-registry-geo-replication/ target=_blank rel=noopener>Microsoft Azure annonserer managed Kubernetes med tjenesten AKS</a></li></ul></li><li>29 november<ul><li><a class=link href=https://aws.amazon.com/blogs/aws/amazon-elastic-container-service-for-kubernetes/ target=_blank rel=noopener>Amazon Web Services annonserer managed Kubernetes med tjenesten EKS</a></li></ul></li></ul><p>De to siste nyhetene er spesielt viktige. √Ö drifte sin egen Kubernetes-installasjon krever tid og kompetanse. (<a class=link href=https://stripe.com/blog/operating-kubernetes target=_blank rel=noopener>Les hvordan Stripe brukte 5 m√•neder p√• √• bli fortrolig med √• drifte sitt eget Kubernetes cluster, bare for batch jobs.</a>)</p><p>Frem til n√• har valget v√¶rt mellom √• drifte sitt eget Kubernetes cluster eller bruke Google Container Engine som har <a class=link href=https://cloudplatform.googleblog.com/2014/11/unleashing-containers-and-kubernetes-with-google-compute-engine.html target=_blank rel=noopener>brukt Kubernetes siden 2014</a>. Mange av oss f√∏ler et visst ubehag ved √• l√•se oss til √©n tilbyder. Men dette er n√• anderledes n√•r en kan utvikle infrastruktur p√• Kubernetes, og velge tiln√¶rmet fritt <strong>*</strong> mellom de 3 store cloud-tilbyderene i tillegg til √• drifte selv om √∏nskelig.</p><p><strong>*</strong> Kubernetes utvikles raskt, og funksjonalitet blir ofte ikke tilgjengelig p√• de ulike platformene samtidig.</p><p><a id=OppretteAKS></a></p><h2 id=opprette-azure-kubernetes-cluster>Opprette Azure Kubernetes Cluster</h2><p><a id=Forbehold></a></p><h3 id=forbehold>Forbehold</h3><blockquote><p>Denne gjennomgangen tar utgangspunkt i dokumentasjonen p√• <a class=link href=https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough target=_blank rel=noopener>Microsoft.com</a>. √Ö sette opp et Azure Kubernetes cluster fungerte ikke i starten av desember, men per dags dato, 23. desember, ser det ut til √• fungere relativt bra. Men, oppgradering av cluster fra Kubernetes 1.7 til 1.8 fungerer for eksempel IKKE.</p><p>AKS er i Preview og Azure jobber kontinuerlig med √• gj√∏re AKS stabilt og st√∏tte s√• mange Kubernetes-funksjoner som mulig. Amazon Web Services har tilsvarende en lukket invite-only Preview per dags dato mens de ogs√• jobber med stabilitet og funksjonalitet.</p><p>B√•de Azure og AWS uttrykker forventning om at deres Kubernetes tjenester skal v√¶re klare for produksjonsmilj√∏ ila 2018.</p></blockquote><p><a id=Forberedelser></a></p><h3 id=forberedelser>Forberedelser</h3><p>Du beh√∏ver Azure-CLI (versjon 2.0.21 eller nyere) for √• utf√∏re kommandoene:</p><ul><li><a class=link href=https://aka.ms/InstallAzureCliWindows target=_blank rel=noopener>Last ned Azure-CLI her</a></li><li><a class=link href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" target=_blank rel=noopener>Informasjon om Azure-CLI p√• MacOS og Linux finner du her</a></li></ul><p>Alle kommandoer gj√∏res i Windows PowerShell.</p><p><a id=Azureinnlogging></a></p><h3 id=azure-innlogging>Azure innlogging</h3><p>Logg p√• Azure:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az login
</span></span></code></pre></td></tr></table></div></div><p>Du f√•r en link som du √•pner i din browser samt en autentiseringskode. Skriv koden p√• nettsiden og <code>az login</code> lagrer p√•loggingsinformasjonen slik at du ikke beh√∏ver √• autentisere igjen p√• samme maskin.</p><blockquote><p><strong>PS</strong> P√•logingsinformasjonen lagres i <code>C:\Users\Brukernavn\.azure\</code>. Du m√• selv passe p√• at ingen kopierer disse filene. Da f√•r de full tilgang til din Azure konto.</p></blockquote><p><a id=AktiverContainerService></a></p><h3 id=aktiver-containerservice>Aktiver ContainerService</h3><p>Siden AKS er i Preview/Beta m√• du eksplisitt aktivere det for √• f√• tilgang til <code>aks</code> kommandoene.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az provider register -n Microsoft.ContainerService
</span></span><span class=line><span class=cl>az provider show -n Microsoft.ContainerService
</span></span></code></pre></td></tr></table></div></div><p><a id=OpprettResourceGroup></a></p><h3 id=opprett-en-resource-group>Opprett en resource group</h3><p>Her oppretter vi en resource group med navn &ldquo;min_aks_rg&rdquo; i Azure region West Europe.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az group create --name min_aks_rg --location westeurope
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Protip</strong>
For √• se en liste over tilgjengelige Azure regioner, bruk kommandoen <code>az account list-locations --output table</code>. <strong>PS</strong> Det kan hende AKS ikke er tilgjengelig i alle regioner enda.</p></blockquote><p><a id=OpprettK8sCluster></a></p><h3 id=opprette-kubernetes-cluster>Opprette Kubernetes cluster</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az aks create --resource-group min_aks_rg --name mitt_cluster --node-count 3 --generate-ssh-keys --node-vm-size Standard_B2s --node-osdisk-size 256 --kubernetes-version 1.8.2
</span></span></code></pre></td></tr></table></div></div><ul><li><code>--node-count</code><ul><li>Antall vertsmaskiner tilgjengelig for √• kj√∏re containers</li></ul></li><li><code>--generate-ssh-keys</code><ul><li>Oppretter og outputter en SSH key som kan brukes for √• SSHe direkte til vertsmaskinene.</li></ul></li><li><code>--node-vm-size</code><ul><li>Hvilken type Azure VM clusteret skal best√• av. For √• se tilgjengelige st√∏rrelser bruk <code>az vm list-sizes -l westeurope --output table</code> og <a class=link href=https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes target=_blank rel=noopener>Microsofts nettsider.</a></li></ul></li><li><code>--node-osdisk-size</code><ul><li>Disk st√∏rrelse p√• vertsmaskiner i GB. <strong>PS</strong> Conteinere kan bli stoppet og flyttet til en annen host ved behov eller hvis en vertsmaskin forsvinner. Alle data lagret lokalt i conteineren blir da borte. Hvis en skal lagre ting permanent m√• en bruke PersistentVolumes og ikke lokal disk p√• vertsmaskin.</li></ul></li><li><code>--kubernetes-version</code><ul><li>Hvilken Kubernetes versjon som skal installeres. Azure installerer IKKE den siste versjonen som standard, og per dags dato fungerer ikke <code>az aks upgrade</code> tilstrekkelig. Siste tilgjengelige versjon per dags dato er 1.8.2. Det er en fordel √• bruke siste versjon da det skjer store forbedringer i Kubernetes fra versjon til versjon. Dokumentasjon er ogs√• mye bedre for nyere versjoner.</li></ul></li></ul><p>Lagre teksten som kommandoen spytter ut i en fil p√• en trygg plass. Den inneholder n√∏kler som kan brukes for √• kople til clusteret med SSH. Selv om det i teorien ikke skal v√¶re n√∏dvendig.</p><p><a id=InstallerKubectl></a></p><h3 id=installer-kubectl>Installer kubectl</h3><p><code>kubectl</code> er klienten som gj√∏r alle operasjoner mot ditt Kubernetes cluster. Azure CLI kan installere <code>kubectl</code> for deg:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az aks install-cli
</span></span></code></pre></td></tr></table></div></div><p>Etter <code>kubectl</code> er installert beh√∏ver vi √• f√• p√•loggingsinformasjon slik at <code>kubectl</code> kan kommunisere med Kubernetes clusteret.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az aks get-credentials --resource-group min_aks_rg --name mitt_cluster
</span></span></code></pre></td></tr></table></div></div><p>P√•loggingsinformasjonen lagres i <code>C:\Users\Brukernavn\.kube\config</code>. Hold disse filene hemmelig ogs√•.</p><blockquote><p><strong>Protip</strong> N√•r en har flere ulike Kubernetes clusters kan en bytte hvilken <code>kubectl</code> skal snakke til med <code>kubectl config get-contexts</code> og <code>kubectl config set-context mitt_cluster</code>.</p></blockquote><p><a id=InspiserCluster></a></p><h3 id=inspiser-cluster>Inspiser cluster</h3><p>For √• se at clusteret og <code>kubectl</code> virker begynner vi med noen kommandoer.</p><p>Se alle vertsmaskiner og status:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME                       STATUS    AGE       VERSION
</span></span><span class=line><span class=cl>aks-nodepool1-16970026-0   Ready     15m       v1.8.2
</span></span><span class=line><span class=cl>aks-nodepool1-16970026-1   Ready     15m       v1.8.2
</span></span><span class=line><span class=cl>aks-nodepool1-16970026-2   Ready     15m       v1.8.2
</span></span></code></pre></td></tr></table></div></div><p>Se alle tjenester, pods, deployments:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get all --all-namespaces
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                          READY     STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   po/kubernetes-dashboard-6fc8cf9586-frpkn      1/1       Running   0          3d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                          CLUSTER-IP     EXTERNAL-IP     PORT(S)           AGE
</span></span><span class=line><span class=cl>kube-system   svc/kubernetes-dashboard      10.0.161.132   &lt;none&gt;          80/TCP            3d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                             DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>kube-system   deploy/kubernetes-dashboard      1         1         1            1           3d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                    DESIRED   CURRENT   READY     AGE
</span></span><span class=line><span class=cl>kube-system   rs/kubernetes-dashboard-6fc8cf9586      1         1         1         3d
</span></span></code></pre></td></tr></table></div></div><p>Jeg har bare tatt et lite utdrag fra denne kommandoen. Du beh√∏ver ikke √• forst√• hva alle ressursene i <code>kube-system</code> namespacet gj√∏r. Det er hensikten at du skal slippe det n√•r Microsoft st√•r for management av selve clusteret.</p><blockquote><p><strong>Namespaces</strong>
I Kubernetes er det noe som heter Namespaces. Ressurser i ett namespace har ikke automatisk tilgang til ressurser i et annet namespace. Tjenestene som Kubernetes selv benytter installeres i namespacet <code>kube-system</code>. Kommandoen <code>kubectl</code> viser deg vanligvis bare ressurser i <code>default</code> namespace med mindre du spesifiserer <code>--all-namespaces</code> eller <code>--namespace=xx</code>.</p></blockquote><p><a id=StarteNginx></a></p><h3 id=starte-noen-nginx-containere>Starte noen nginx containere</h3><blockquote><p>En instans av en kj√∏rende container kalles i Kubernetes for en <strong>Pod</strong>.</p></blockquote><blockquote><p><code>nginx</code> er en rask og fleksibel webserver.</p></blockquote><p>N√• som clusteret er oppe √• kj√∏re kan vi begynne √• rulle ut tjenster og deployments p√• det.</p><p>Vi begynner med √• lage en Deployment best√•ende av 3 containere som alle kj√∏rer <code>nginx:mainline-alpine</code> imaget fra <a class=link href=https://hub.docker.com/r/_/nginx/ target=_blank rel=noopener>Docker hub</a>.</p><p><strong>nginx-dep.yaml</strong> ser slik ut:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: apps/v1beta2
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx-deployment
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: nginx
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 3
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: nginx
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nginx
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: nginx
</span></span><span class=line><span class=cl>        image: nginx:mainline-alpine
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 80
</span></span></code></pre></td></tr></table></div></div><p>Last denne inn p√• clusteret med <code>kubectl create</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl create -f https://raw.githubusercontent.com/StianOvrevage/gh-pages-blog/master/static/attachments/2017-12-23-managed-kubernetes-on-azure/nginx-dep.yaml
</span></span></code></pre></td></tr></table></div></div><p>Denne kommandoen oppretter ressursene beskrevet i filen. <code>kubectl</code> kan lese filer enten lokalt fra din maskin eller fra en URL.</p><blockquote><p>Etter du har gjort endringer i en ressurs-definisjon (<code>.yaml</code> fil) kan du oppdatere ressursene i clusteret med <code>kubectl replace -f ressurs.yaml</code></p></blockquote><p>Vi kan verifisere at Deployment er klar:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get deploy
</span></span><span class=line><span class=cl>NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx-deployment   3         3         3            3           10m
</span></span></code></pre></td></tr></table></div></div><p>Vi kan ogs√• hente de faktiske Pods som er startet:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get pods
</span></span><span class=line><span class=cl>NAME                                READY     STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>nginx-deployment-569477d6d8-dqwx5   1/1       Running   0          10m
</span></span><span class=line><span class=cl>nginx-deployment-569477d6d8-xwzpw   1/1       Running   0          10m
</span></span><span class=line><span class=cl>nginx-deployment-569477d6d8-z5tfk   1/1       Running   0          10m
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Logger</strong> Vi kan se logger fra √©n pod med <code>kubectl logs nginx-deployment-569477d6d8-xwzpw</code>. Men siden vi i dette tilfellet ikke vet hvilken Pod som ender opp med √• f√• innkommende foresp√∏rsler kan vi se logger fra alle Pods som har <code>app=nginx</code> label: <code>kubectl logs -lapp=nginx</code>. At vi her bruker <code>app=nginx</code> har vi selv bestemt i <code>nginx-dep.yaml</code> n√•r vi satt <code>spec.template.metadata.labels: app: nginx</code>.</p></blockquote><p><a id=NginxService></a></p><h3 id=gj√∏re-nginx-tilgjengelig-med-en-tjeneste>Gj√∏re nginx tilgjengelig med en tjeneste</h3><p>For √• kommunisere med v√•re nye Pods beh√∏ver vi √• opprette en tjeneste (<strong>Service</strong>). En tjeneste best√•r av en eller flere Pods som velges basert p√• ulike kriterier, blant annet hvilke labels de har og om Podene det gjelder er Running og Ready.</p><p>N√• lager vi en tjeneste som ruter trafikk til alle Pods som har label <code>app: nginx</code> og som lytter p√• port 80. I tillegg gj√∏r vi tjenesten tilgjengelig via en LoadBalancer:</p><p><strong>nginx-svc.yaml</strong> ser slik ut:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nginx
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: nginx
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: LoadBalancer
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  - port: 80
</span></span><span class=line><span class=cl>    name: http
</span></span><span class=line><span class=cl>    targetPort: 80
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: nginx
</span></span></code></pre></td></tr></table></div></div><p>Vi ber Kubernetes om √• opprette tjeneten v√•r med <code>kubectl create</code> som vanlig:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl create -f https://raw.githubusercontent.com/StianOvrevage/gh-pages-blog/master/static/attachments/2017-12-23-managed-kubernetes-on-azure/nginx-svc.yaml
</span></span></code></pre></td></tr></table></div></div><p>Deretter kan vi se hvilken IP-adresse tjenesten v√•r har f√•tt av Azure:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get svc -w
</span></span><span class=line><span class=cl>NAME         CLUSTER-IP   EXTERNAL-IP     PORT(S)        AGE
</span></span><span class=line><span class=cl>nginx        10.0.24.11   13.95.173.255   80:31522/TCP   15m
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>PS</strong> Det kan ta et par minutter for Azure √• tildele tjenesten v√•r en Public IP, i mellomtiden vil det st√• <code>&lt;pending></code> under EXTERNAL-IP.</p></blockquote><p>En enkel <strong>Welcome to nginx</strong> webside skal n√• v√¶re tilgjengelig p√• http://13.95.173.255 (<em>husk √• bytt ut med din egen External-IP</em>).</p><p><strong>Vi har n√• en lastbalansert <code>nginx</code> tjeneste med 3 servere klar til √• ta imot trafikk.</strong></p><p>For ordens skyld kan vi slette tjeneste og deployment etterp√•:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl delete svc nginx
</span></span><span class=line><span class=cl>kubectl delete deploy nginx-deployment
</span></span></code></pre></td></tr></table></div></div><p><a id=ScaleCluster></a></p><h3 id=skalere-cluster>Skalere cluster</h3><p>Hvis en √∏nsker √• endre antall vertsmaskiner/noder som kj√∏rer Pods kan en gj√∏re det via Azure-CLI:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az aks scale --name mitt_cluster --resource-group min_aks_rg --node-count 5
</span></span></code></pre></td></tr></table></div></div><blockquote><p>For √∏yeblikket blir alle noder opprettet med samme st√∏rrelse som n√•r clusteret ble opprettet. AKS vil antageligvis f√• st√∏tte for <a class=link href=https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools target=_blank rel=noopener><strong>node-pools</strong></a> i l√∏pet av neste √•r. Da kan en opprette grupper av noder med forskjellig st√∏rrelse og operativsystem, b√•de Linux og Windows.</p></blockquote><p><a id=DeleteCluster></a></p><h3 id=slette-cluster>Slette cluster</h3><p>En kan slette hele clusteret slik:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>az aks delete --name mitt_cluster --resource-group min_aks_rg --yes
</span></span></code></pre></td></tr></table></div></div><p><a id=Bonusmateriale></a></p><h2 id=bonusmateriale>Bonusmateriale</h2><p>Her er litt bonusmateriale dersom du √∏nsker √• g√• enda litt videre med Kubernetes.</p><p><a id=HelmIntro></a></p><h3 id=rulle-ut-tjenester-med-helm>Rulle ut tjenester med Helm</h3><p><a class=link href=https://helm.sh/ target=_blank rel=noopener>Helm</a> er en pakke-behandler og et bibliotek av programvare som er klart for √• rulles ut i et Kubernetes-cluster.</p><p>Start med √• laste ned <a class=link href=https://github.com/kubernetes/helm/releases target=_blank rel=noopener>Helm-klienten</a>. Den henter p√•loggingsinformasjon osv fra samme sted som <code>kubectl</code> automatisk.</p><p>Installer Helm-serveren (Tiller) p√• Kubernetes clusteret og oppdater pakke-biblioteket:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm init
</span></span><span class=line><span class=cl>helm repo update
</span></span></code></pre></td></tr></table></div></div><p>Se tilgjengelige pakker (<strong>Charts</strong>) med: <code>helm search</code>.</p><p><a id=HelmMinecraft></a></p><h4 id=rulle-ut-minecraft-med-helm>Rulle ut MineCraft med Helm</h4><p>La oss rulle ut en MineCraft installasjon p√• clusteret v√•rt, fordi vi kan :-)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm install --name stian-sin --set minecraftServer.eula=true stable/minecraft
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>--set</code> overstyrer en eller flere av standardverdiene som er satt i pakken. MineCraft pakken er laget slik at den ikke starter uten √• ha sagt seg enig i brukervilk√•rene i variabelen <code>minecraftServer.eula</code>. Alle variablene som kan overstyres i MineCraft pakken er <a class=link href=https://github.com/kubernetes/charts/blob/master/stable/minecraft/values.yaml target=_blank rel=noopener>dokumentert her</a>.</p></blockquote><p>S√• venter vi litt p√• at Azure skal tildele en Public IP:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl get svc -w
</span></span><span class=line><span class=cl>stian-sin-minecraft   10.0.237.0   13.95.172.192   25565:30356/TCP   3m
</span></span></code></pre></td></tr></table></div></div><p>Og vipps kan vi kople til Minecraft p√• <code>13.95.172.192:25565</code>.</p><p><img src=/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/minecraft-k8s.png width=856 height=507 srcset="/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/minecraft-k8s_hu13197832490752396686.png 480w, /p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/minecraft-k8s_hu16352153299487520650.png 1024w" loading=lazy alt="Kubernetes in MineCraft on Kubernetes" class=gallery-image data-flex-grow=168 data-flex-basis=405px></p><p><a id=KubernetesDashboard></a></p><h3 id=kubernetes-dashboard>Kubernetes Dashboard</h3><p>Kubernetes har ogs√• et grafisk web-grensesnitt som gj√∏r det litt lettere √• se hvilke ressurser som er i clusteret, se logger og √•pne remote-shell inne i en kj√∏rende Pod, blant annet.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; kubectl proxy
</span></span><span class=line><span class=cl>Starting to serve on 127.0.0.1:8001
</span></span></code></pre></td></tr></table></div></div><p><code>kubectl</code> krypterer og tunnelerer trafikken inn til Kubernetes&rsquo; API servere. Dashboardet er tilgjengelig p√• <a class=link href=http://127.0.0.1:8001/ui/ target=_blank rel=noopener>http://127.0.0.1:8001/ui/</a>.</p><p><img src=/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/k8s-dash.png width=899 height=588 srcset="/p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/k8s-dash_hu15091082541702636396.png 480w, /p/managed-kubernetes-p%C3%A5-microsoft-azure-norwegian/k8s-dash_hu17318776918264020386.png 1024w" loading=lazy alt="Kubernetes Dashboard" class=gallery-image data-flex-grow=152 data-flex-basis=366px></p><p><a id=Konklusjon></a></p><h2 id=konklusjon>Konklusjon</h2><p>Jeg h√•per du har f√•tt mersmak for Kubernetes. L√¶rekurven kan v√¶re litt bratt i begynnelsen men det tar ikke s√• veldig lang tid f√∏r du er produktiv.</p><p>Se p√• de <a class=link href=https://v1-8.docs.kubernetes.io/docs/tutorials/ target=_blank rel=noopener>offisielle guidene p√• Kubernetes.io</a> for √• l√¶re mer om hvordan du definerer forskjellige typer ressurser og tjenester for √• kj√∏re p√• Kubernetes. <strong>PS: Det gj√∏res store endringer fra versjon til versjon s√• s√∏rg for √• bruke dokumentasjonen for riktig versjon!</strong></p><p>Kubernetes har ogs√• et veldig aktivt Slack-milj√∏ p√• <a class=link href=http://slack.k8s.io/ target=_blank rel=noopener>kubernetes.slack.com</a>. Der er det ogs√• en kanal for norske Kubernetes brukere; <strong>#norw-users</strong>.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/azure/>Azure</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Dec 25, 2017 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/mini-post-down-scaling-azure-kubernetes-service-aks/><div class=article-image><img src=/p/mini-post-down-scaling-azure-kubernetes-service-aks/2019-06-04-downscaling-aks.329aba45d5c630b3af497bbb7a43f404_hu14101488926934199810.png width=250 height=150 loading=lazy alt="Featured image of post Mini-post: Down-scaling Azure Kubernetes Service (AKS)" data-hash="md5-Mpq6RdXGMLOvSXu7ekP0BA=="></div><div class=article-details><h2 class=article-title>Mini-post: Down-scaling Azure Kubernetes Service (AKS)</h2></div></a></article><article class=has-image><a href=/p/disk-performance-on-azure-kubernetes-service-aks-part-1-benchmarking/><div class=article-image><img src=/p/disk-performance-on-azure-kubernetes-service-aks-part-1-benchmarking/2019-02-23-disk-performance-on-aks-part-1.ab18dd1b8670f56fe898797506d57abc_hu17823714411359167148.png width=250 height=150 loading=lazy alt="Featured image of post Disk performance on Azure Kubernetes Service (AKS) - Part 1: Benchmarking" data-hash="md5-qxjdG4Zw9W/omHl1BtV6vA=="></div><div class=article-details><h2 class=article-title>Disk performance on Azure Kubernetes Service (AKS) - Part 1: Benchmarking</h2></div></a></article><article class=has-image><a href=/p/managed-kubernetes-on-microsoft-azure-english/><div class=article-image><img src=/p/managed-kubernetes-on-microsoft-azure-english/2017-12-23-managed-kubernetes-on-azure-eng.bf0fcb04c841710921f10d2e885d8555_hu4992157927612583129.png width=250 height=150 loading=lazy alt="Featured image of post Managed Kubernetes on Microsoft Azure (English)" data-hash="md5-vw/LBMhBcQkh8Q0uiF2FVQ=="></div><div class=article-details><h2 class=article-title>Managed Kubernetes on Microsoft Azure (English)</h2></div></a></article><article class=has-image><a href=/p/kubernetes-dont-use-nodelocal-dnscache-on-gke-without-cloud-dns/><div class=article-image><img src=/p/kubernetes-dont-use-nodelocal-dnscache-on-gke-without-cloud-dns/cover.b44ff6851020084489a2bbba9c34cdea_hu14327566051345104457.webp width=250 height=150 loading=lazy alt="Featured image of post Kubernetes: Don't use NodeLocal DNSCache on GKE (without Cloud DNS)" data-hash="md5-tE/2hRAgCESJoru6nDTN6g=="></div><div class=article-details><h2 class=article-title>Kubernetes: Don't use NodeLocal DNSCache on GKE (without Cloud DNS)</h2></div></a></article><article class=has-image><a href=/p/kubernetes-sidecar-config-drift/><div class=article-image><img src=/p/kubernetes-sidecar-config-drift/2022-05-03-kubernetes-sidecar-config-drift.099fc947effb12fa5df1b55ff2abbf0f_hu6448980740578202474.png width=250 height=150 loading=lazy alt="Featured image of post Kubernetes Sidecar Config Drift" data-hash="md5-CZ/JR+/7Evpd8bVf8qu/Dw=="></div><div class=article-details><h2 class=article-title>Kubernetes Sidecar Config Drift</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2014 -
2024 blog.stian.omg.lol</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>